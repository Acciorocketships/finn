import torch
from finn import Finn
from matplotlib import pyplot as plt

def run():
        # torch.manual_seed(3)

        x = torch.tensor([[0.2445, 1.7579, -0.4431, 0.8229],
                [-0.1701, 1.5750, -0.8577, 0.6400],
                [0.7415, -0.0595, 0.2898, -0.3654],
                [0.3824, -0.1941, -0.0693, -0.5000],
                [-0.8480, 0.0289, 0.4494, -0.6795],
                [-0.9635, 0.4278, 0.3339, -0.2806],
                [-1.4810, -0.6112, -0.6195, -1.3507],
                [-1.7602, 0.6955, -0.8987, -0.0440],
                [-1.0204, 0.3389, -1.1981, 0.9061],
                [-0.2623, -0.9593, -0.4400, -0.3921],
                [-0.0371, 1.0046, 1.4251, -0.0175],
                [-0.3887, -0.0600, 1.0735, -1.0821],
                [-0.1115, -0.5411, 0.8131, -0.1608],
                [-0.3986, -0.8840, 0.5260, -0.5037],
                [-0.6782, 0.5443, -0.7456, 0.0254],
                [-0.3494, 1.4389, -0.4168, 0.9200],
                [-0.2929, -0.8867, 0.2894, -1.3510],
                [-0.0396, -0.4588, 0.5427, -0.9232],
                [-0.5726, -0.2553, -0.4613, 1.2852],
                [-1.0227, -0.2126, -0.9114, 1.3278],
                [0.6554, 0.9208, -0.5734, -0.1020],
                [1.6783, 1.2179, 0.4495, 0.1951],
                [0.0158, 1.4609, -0.9987, 0.7170],
                [1.6820, 0.3646, 0.6675, -0.3793],
                [0.6652, -0.0699, 0.7375, 1.5013],
                [0.5987, -1.2178, 0.6710, 0.3535],
                [-0.0866, 1.0317, 0.2773, 1.7980],
                [-0.8233, -0.7593, -0.4595, 0.0070],
                [-1.1761, 1.3240, -0.7519, 0.7419],
                [-0.1492, 0.2413, 0.2750, -0.3408],
                [-0.3847, -1.2599, -0.2518, -0.3909],
                [-0.9803, -1.5361, -0.8474, -0.6671],
                [-0.4088, 1.1394, 0.3010, -0.3557],
                [-1.1048, 0.6614, -0.3950, -0.8336],
                [-0.7885, -0.4538, -0.7370, -0.7511],
                [-0.6216, -0.0228, -0.5701, -0.3201],
                [1.1269, 0.8055, -0.4185, 0.1010],
                [0.5101, 0.2393, -1.0354, -0.4652],
                [1.1543, -0.8433, -0.2231, -0.5298],
                [1.2989, -1.2447, -0.0784, -0.9311],
                [0.1459, -0.4681, -0.2129, 0.3105],
                [0.3197, 0.1394, -0.0391, 0.9179],
                [0.2333, -0.8708, 1.1478, -0.6275],
                [-0.1331, 0.3840, 0.7814, 0.6272],
                [0.6935, -1.0463, 0.4599, -1.6960],
                [0.3436, -0.3990, 0.1099, -1.0486],
                [1.1934, -0.1405, 0.2638, 1.1826],
                [-0.6191, -0.9122, -1.5487, 0.4109],
                [-0.6135, 0.5136, 0.5857, 0.9236],
                [-0.4168, 0.9099, 0.7824, 1.3199],
                [-0.6472, 0.4971, 0.6389, 0.0137],
                [-1.2376, 1.2802, 0.0485, 0.7969],
                [0.6297, 0.7888, 0.2826, 1.0753],
                [0.3512, -0.8061, 0.0041, -0.5195],
                [-1.7443, -0.8566, -0.2261, -0.4748],
                [-0.3932, -0.6551, 1.1250, -0.2733],
                [-0.8297, 0.8396, -0.6586, -0.5284],
                [0.0348, 0.3918, 0.2059, -0.9762],
                [1.6015, -1.4858, 0.6519, -0.4348],
                [0.3022, -1.2971, -0.6474, -0.2461],
                [-0.4452, 0.8922, -0.6994, 1.0598],
                [0.0540, 1.5387, -0.2002, 1.7063],
                [0.7935, -0.6897, 0.1643, 0.2263],
                [0.0308, -0.6092, -0.5985, 0.3069],
                [0.0143, 1.4186, 1.8136, -0.2180],
                [-1.2730, 0.0022, 0.5263, -1.6345],
                [1.2403, 0.5534, 0.1980, 1.0942],
                [1.2265, -0.3161, 0.1843, 0.2246],
                [0.2976, 0.1701, -0.4197, 1.3070],
                [-0.1245, -0.8069, -0.8418, 0.3300],
                [1.5381, -0.0756, 1.5747, -0.4051],
                [-0.2174, -0.7039, -0.1808, -1.0334],
                [-1.1726, 0.6899, -0.6790, 0.4659],
                [-1.6381, -0.2323, -1.1446, -0.4563],
                [-0.0590, -1.6351, -0.0048, -1.9156],
                [-0.1983, -0.3137, -0.1441, -0.5942],
                [0.7528, 0.1314, 0.7796, -1.4194],
                [1.2153, 1.1604, 1.2422, -0.3904],
                [-0.4651, 0.8534, 0.3196, -0.3844],
                [-1.0028, 0.8491, -0.2181, -0.3887],
                [-0.3689, 0.8579, 1.0227, -0.8636],
                [0.0447, 1.8051, 1.4363, 0.0837],
                [0.9925, -0.1695, 0.0759, -1.2227],
                [-0.4173, 0.7756, -1.3339, -0.2775],
                [0.0789, -0.4686, -1.4867, -0.1055],
                [0.7194, 0.3575, -0.8462, 0.7206],
                [-0.2841, -0.0136, 0.6374, -0.1406],
                [-1.4346, 1.3541, -0.5131, 1.2271],
                [0.6766, -1.2135, 1.2213, -1.4754],
                [1.3185, -0.3967, 1.8633, -0.6585],
                [0.9884, 0.0616, 0.5887, 0.2892],
                [1.2630, 0.7602, 0.8633, 0.9878],
                [1.1772, -0.1506, 0.4081, 0.4856],
                [1.1360, -0.8158, 0.3669, -0.1796],
                [0.1069, 0.8395, -1.0425, 1.3749],
                [-0.0653, -0.3152, -1.2147, 0.2201],
                [-0.2180, 0.4727, -0.8225, 0.0192],
                [1.3602, 0.3992, 0.7556, -0.0543],
                [1.3776, -1.5797, 1.3851, -0.9803],
                [0.6682, -0.2892, 0.6757, 0.3102],
                [0.3407, -0.5539, -0.8356, -0.7575],
                [1.5722, -0.1799, 0.3959, -0.3835],
                [0.8409, -0.9388, 1.2067, 0.4993],
                [0.6189, -0.7169, 0.9848, 0.7213],
                [-1.3547, 1.0851, -0.3324, 1.5602],
                [0.1289, 1.3814, 1.1513, 1.8565],
                [0.5861, -0.3940, 0.7208, -1.0405],
                [-0.1184, 0.3506, 0.0163, -0.2959],
                [0.0120, -0.3072, -0.7816, 0.2860],
                [-0.5531, 0.1433, -1.3466, 0.7366],
                [0.5418, -1.0000, -0.1367, 0.4491],
                [0.9685, -0.2166, 0.2900, 1.2325],
                [-0.4029, -0.4697, 0.1519, -1.0514],
                [-0.6920, -0.9593, -0.1372, -1.5409],
                [-0.5510, -0.4171, -0.6556, -1.4363],
                [-1.7361, -0.3077, -1.8406, -1.3269],
                [0.0212, -1.5414, 0.0794, -0.2843],
                [1.0420, -1.4106, 1.1002, -0.1536],
                [0.7482, 1.0479, 0.8974, 1.7142],
                [0.4817, -0.7756, 0.6309, -0.1093]])

        n_finn_layers = 3
        x_lim_lower = torch.tensor([-2.8, -2.8, -2.8, -2.8])
        x_lim_upper = torch.tensor([2.8, 2.8, 2.8, 2.8])

        area = torch.prod(x_lim_upper-x_lim_lower)

        f = Finn(
                dim=x.shape[-1],
                area=area,
                pos=True,
                k=1,
                nlayers=n_finn_layers,
                x_lim_lower=x_lim_lower,
                x_lim_upper=x_lim_upper,
        )

        y = f(x)

        print(y)

        # Y = f.F(x)
        # for i in range(x.shape[-1]):
        #         plt.scatter(x[:,i].detach(), y.detach())
        # plt.show()

if __name__ == "__main__":
        run()